(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{140:function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return d}));var n=r(0),a=r.n(n);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var s=a.a.createContext({}),b=function(e){var t=a.a.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},p=function(e){var t=b(e.components);return a.a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},h=a.a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,i=e.originalType,o=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),p=b(r),h=n,d=p["".concat(o,".").concat(h)]||p[h]||u[h]||i;return r?a.a.createElement(d,l(l({ref:t},s),{},{components:r})):a.a.createElement(d,l({ref:t},s))}));function d(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=r.length,o=new Array(i);o[0]=h;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:n,o[1]=l;for(var s=2;s<i;s++)o[s]=r[s];return a.a.createElement.apply(null,o)}return a.a.createElement.apply(null,r)}h.displayName="MDXCreateElement"},141:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r(20);t.default=function(){var e=Object(n.useContext)(a.a);if(null===e)throw new Error("Docusaurus context not provided");return e}},142:function(e,t,r){"use strict";r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return o}));var n=r(141),a=r(143);function i(){var e=Object(n.default)().siteConfig,t=(e=void 0===e?{}:e).baseUrl,r=void 0===t?"/":t,i=e.url;return{withBaseUrl:function(e,t){return function(e,t,r,n){var i=void 0===n?{}:n,o=i.forcePrependBaseUrl,l=void 0!==o&&o,c=i.absolute,s=void 0!==c&&c;if(!r)return r;if(r.startsWith("#"))return r;if(Object(a.b)(r))return r;if(l)return t+r;var b=r.startsWith(t)?r:t+r.replace(/^\//,"");return s?e+b:b}(i,r,e,t)}}}function o(e,t){return void 0===t&&(t={}),(0,i().withBaseUrl)(e,t)}},143:function(e,t,r){"use strict";function n(e){return!0===/^(\w*:|\/\/)/.test(e)}function a(e){return void 0!==e&&!n(e)}r.d(t,"b",(function(){return n})),r.d(t,"a",(function(){return a}))},97:function(e,t,r){"use strict";r.r(t),r.d(t,"frontMatter",(function(){return l})),r.d(t,"metadata",(function(){return c})),r.d(t,"rightToc",(function(){return s})),r.d(t,"default",(function(){return p}));var n=r(3),a=r(7),i=(r(0),r(140)),o=r(142),l={id:"public-releases",title:"Public Flipper Releases"},c={unversionedId:"extending/public-releases",id:"extending/public-releases",isDocsHomePage:!1,title:"Public Flipper Releases",description:"This document outlines how Flipper releases work on GitHub.",source:"@site/../docs/extending/public-releases.mdx",slug:"/extending/public-releases",permalink:"/docs/extending/public-releases",editUrl:"https://github.com/facebook/flipper/blob/master/website/../docs/extending/public-releases.mdx",version:"current"},s=[{value:"Kick-Off",id:"kick-off",children:[]},{value:"Desktop Release",id:"desktop-release",children:[]},{value:"Android Release",id:"android-release",children:[]},{value:"iOS Release",id:"ios-release",children:[]},{value:"npm releases",id:"npm-releases",children:[]}],b={rightToc:s};function p(e){var t=e.components,r=Object(a.a)(e,["components"]);return Object(i.b)("wrapper",Object(n.a)({},b,r,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,"This document outlines how Flipper releases work on GitHub."),Object(i.b)("h2",{id:"kick-off"},"Kick-Off"),Object(i.b)("p",null,"A release is kicked off by a special commit that has a subject with the format\n",Object(i.b)("inlineCode",{parentName:"p"},"Flipper Release vX.Y.Z"),", e.g. ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/facebook/flipper/commit/4fa2c9761a8359c65ccc62fee76490572616f0c1"}),"4fa2c9761"),"."),Object(i.b)("p",null,"This is triggered from a bot within Facebook that runs ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/facebook/flipper/blob/master/scripts/prepare-release.sh"}),"prepare-release.sh"),"\nbut the only thing special about the commit is its subject line. Anyone could run the\nscript and would kick off the remaining jobs once the commit lands in master."),Object(i.b)("p",null,"The commit bumps the version of Flipper Desktop as well as various SDK components\nand libraries that are to be published to npm and other package repositories."),Object(i.b)("p",null,'Importantly, it is immediately followed by a "SNAPSHOT" commit (e.g. ',Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/facebook/flipper/commit/02a56da3f5440b35616604f73167307319cca48f"}),"02a56da3f"),") which sets\nthe version of our Java dependencies to ",Object(i.b)("inlineCode",{parentName:"p"},"X.Y.(Z+1)-SNAPSHOT")," (that's the\npatch version incremented by one and a ",Object(i.b)("inlineCode",{parentName:"p"},"-SNAPSHOT")," suffix appended).\nThat's a weird Maven-ism which allows us to continuously publish snapshot\nreleases from the main branch."),Object(i.b)("h2",{id:"desktop-release"},"Desktop Release"),Object(i.b)("p",null,"The release process for the desktop app is entirely driven by ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/features/actions"}),"GitHub Actions"),".\nThe entry point is the ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/facebook/flipper/blob/master/.github/workflows/release.yml"}),"release.yml")," workflow\nwhich is triggered by changes to the ",Object(i.b)("inlineCode",{parentName:"p"},"desktop/package.json")," file on the main branch."),Object(i.b)("p",null,"GitHub Actions has a limitation we need to work around here: It allows push events to as triggers for\na workflow, but not individual commits. This requires us to first scan through all potential commits\nof a push to identify commits that match the aforementioned versioning schema.\nThis is done through a ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/facebook/flipper/blob/1cad57d75077bdb3594e33e845ab6d226c5d2c86/.github/workflows/release.yml#L15-L18"}),"custom action"),"."),Object(i.b)("p",null,"Only if this action is successful, the remaining steps are taken which"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Check out the versioning commit."),Object(i.b)("li",{parentName:"ul"},"Create a git tag for it."),Object(i.b)("li",{parentName:"ul"},"Create a GitHub release for the tag."),Object(i.b)("li",{parentName:"ul"},"Build releases for Linux, Mac and Windows."),Object(i.b)("li",{parentName:"ul"},"Upload all these releases to temporary storage."),Object(i.b)("li",{parentName:"ul"},"Download the release artifacts and attach them to the GitHub release."),Object(i.b)("li",{parentName:"ul"},"Dispatch to separate workflows for publishing Cocoapods and npm packages (see below).")),Object(i.b)("h2",{id:"android-release"},"Android Release"),Object(i.b)("p",null,'Android is currently an outlier in that it does not run on GitHub Actions.\nThis is mainly for legacy reasons but there\'s also a strong "never touch a running system"\ncase to be made.'),Object(i.b)("p",null,"The Android release is run on\n",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://app.circleci.com/pipelines/github/facebook/flipper?branch=master"}),"CircleCI"),"\nand configured in\n",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/facebook/flipper/blob/master/.circleci/config.yml"}),Object(i.b)("inlineCode",{parentName:"a"},".circleci/config.yml"))),Object(i.b)("p",null,"There are two jobs defined:"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"The ",Object(i.b)("inlineCode",{parentName:"li"},"snapshot"),' job runs on every commit on the main branch and publishes "SNAPSHOT" releases to Maven Central.'),Object(i.b)("li",{parentName:"ol"},"The ",Object(i.b)("inlineCode",{parentName:"li"},"release")," job runs only on tags and publishes artifacts to JCenter.")),Object(i.b)("p",null,"There are two potential points for breakage:"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"The ",Object(i.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/facebook/flipper/blob/1cad57d75077bdb3594e33e845ab6d226c5d2c86/.circleci/config.yml#L5"}),"base image")," used in the build instructions refers to a specific SDK version and requires occasional updating."),Object(i.b)("li",{parentName:"ol"},"The ",Object(i.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/facebook/flipper/blob/b5e613141e98528f45d3d2864e08278b1c7d4973/.circleci/config.yml#L23"}),"platform installation")," through the ",Object(i.b)("inlineCode",{parentName:"li"},"sdkmanager")," tool of the Android SDK may require additional SDKs or NDKs to be installed if they're not part of the base image.")),Object(i.b)("p",null,"One non-obvious aspect is that of ",Object(i.b)("strong",{parentName:"p"},"authentication")," for uploads. The repository contains a symmetrically encrypted\ncopy of our credentials to Sonatype (for Maven Central) and JCenter. The ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/facebook/flipper/blob/1cad57d75077bdb3594e33e845ab6d226c5d2c86/scripts/publish-android-release.sh#L19"}),"release scripts"),"\ndecode the file on the fly by using a secret Circle CI exposes through an environment variable."),Object(i.b)("h2",{id:"ios-release"},"iOS Release"),Object(i.b)("p",null,"iOS releases are run in GitHub Actions but exist as a separate workflow. They can be triggered in three ways:"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"When a tag is pushed."),Object(i.b)("li",{parentName:"ol"},"By manually triggering the workflow (see below)."),Object(i.b)("li",{parentName:"ol"},"Through a ",Object(i.b)("inlineCode",{parentName:"li"},"dispatch_workflow")," event which is issued as a last step of the desktop release process.")),Object(i.b)("img",{alt:"Manually triggering a workflow",src:Object(o.a)("img/trigger-publish-pod-workflow.png")}),Object(i.b)("p",null,Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/facebook/flipper/blob/master/.github/workflows/publish-pods.yml"}),"The workflow")," follows the default Cocoapods update procedure, bumps and published both the Flipper and FlipperKit pod\nand finally creates a ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/facebook/flipper/pull/1754"}),"pull request")," containing the updated references. This PR must be manually merged."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Authentication")," is managed through the secret environment variable ",Object(i.b)("inlineCode",{parentName:"p"},"COCOAPODS_TRUNK_TOKEN"),"."),Object(i.b)("h2",{id:"npm-releases"},"npm releases"),Object(i.b)("p",null,"The JavaScript libraries published as part of a Flipper release closely follow the iOS release procedure.\nSame as before, it is a workflow that is triggered by one of the three events, which should in all but\nexceptional circumstances be a dispatch event. The workflow is defined in ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/facebook/flipper/blob/master/.github/workflows/publish-npm.yml"}),"publish-npm.yml"),"."),Object(i.b)("p",null,"From there, we use a ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/facebook/flipper/blob/master/desktop/scripts/bump-versions.ts"}),"script")," to\nbump the versions of our Yarn workspaces, and publish all public packages (",Object(i.b)("inlineCode",{parentName:"p"},"flipper"),", ",Object(i.b)("inlineCode",{parentName:"p"},"flipper-babel-transformer"),", ...)\nand our React Native bindings."),Object(i.b)("p",null,"The ",Object(i.b)("strong",{parentName:"p"},"authentication")," to npm is managed by a secret environment variable called ",Object(i.b)("inlineCode",{parentName:"p"},"FLIPPER_NPM_TOKEN"),"."))}p.isMDXComponent=!0}}]);